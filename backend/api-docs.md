# BestBefore API Documentation

This document provides information about the BestBefore API endpoints, their usage, and expected responses.

## Base URL

All API endpoints are relative to the base URL:

```
http://localhost:8000/api/  # Development
```

## Authentication

### Login

```
POST /auth/login/
```

**Description:** Authenticate a user with a password.

**Request Body:**
```json
{
  "password": "your_site_password"
}
```

**Response:**
- Success (200): Sets an HTTP-only cookie and returns `{ "success": true }`
- Error (401): `{ "error": "Invalid password" }`

## Food Storage & Information

### Get Storage Advice

```
POST /storage-advice/
```

**Description:** Get storage recommendations for a specific food type.

**Request Body:**
```json
{
  "food_type": "tomato"
}
```

**Response:**
- Success (200): Storage recommendations for the specified food type
- Error (400): `{ "error": "Food type is required" }`
- Error (404): `{ "error": "No storage recommendation found for {food_type}" }`

### Get Food Types

```
GET /food-types/
```

**Description:** Get all available food types for storage recommendations.

**Response:**
- Success (200): `{ "food_types": ["apple", "banana", "tomato", ...] }`

## Produce Detection

### Detect Produce

```
POST /detect-produce/
```

**Description:** Identify food items from images using computer vision.

**Request Body:**
- Single image:
```json
{
  "image": "base64_encoded_image_data"
}
```

- Multiple images:
```json
{
  "images": ["base64_encoded_image_1", "base64_encoded_image_2"]
}
```

**Response:**
- Success (200): 
```json
{
  "success": true,
  "detections": [],
  "produce_counts": {
    "apple": 2,
    "banana": 1
  },
  "total_items": 3
}
```
- Error (400): `{ "error": "No images provided" }`

## Calendar & Reminders

### Generate Calendar

```
POST /generate_calendar/
```

**Description:** Generate a calendar with food expiration reminders.

**Request Body:**
```json
{
  "items": [
    {"name": "Milk", "expiry_date": "2023-12-30"},
    {"name": "Eggs", "expiry_date": "2023-12-25"}
  ],
  "reminder_days": 2,
  "reminder_time": "20:00"
}
```

**Response:**
- Success (200): Calendar URL and configuration details
- Error (400): `{ "error": "No items provided" }`

### Get iCalendar File

```
GET /calendar/<calendar_id>.ics
```

**Description:** Get an iCalendar file for import into calendar applications.

**Path Parameters:**
- `calendar_id`: UUID generated by the system

**Response:**
- Success (200): iCalendar file (.ics)

## Food Banks & Community Resources

### Get Food Banks

```
GET /foodbanks/
```

**Description:** List food banks with location and operating hours information.

**Response:**
- Success (200): 
```json
{
  "status": "success",
  "count": 25,
  "data": [
    {
      "id": 1,
      "name": "Community Food Bank",
      "latitude": 37.7749,
      "longitude": -122.4194,
      "type": "Food Bank",
      "hours_of_operation": "Mon-Fri 9am-5pm",
      "address": "123 Main St, City, State 12345",
      "operation_schedule": {
        "monday": {"open": "09:00", "close": "17:00"},
        "tuesday": {"open": "09:00", "close": "17:00"}
      }
    }
  ]
}
```

## Second Life (Food Repurposing)

### Get Second Life Items

```
GET /second-life/
```

**Description:** Find ways to repurpose food items.

**Query Parameters:**
- `search` (optional): Filter by ingredient name (e.g., `?search=bread`)

**Response:**
- Success (200): List of second life methods/recipes

### Get Second Life Item Details

```
GET /second-life/<item_id>/
```

**Description:** Get details for a specific repurposing method.

**Path Parameters:**
- `item_id`: ID of the second life method

**Response:**
- Success (200): Detailed information about the method
- Error (404): `{ "error": "Item not found" }`

## Meal Planning & Grocery Lists

### Generate Grocery List

```
POST /search-dishes/
```

**Description:** Generate grocery lists from selected meals.

**Request Body:**
```json
{
  "selected_meals": ["Pasta Carbonara", "Greek Salad", "Chicken Curry"]
}
```

**Response:**
- Success (200): Combined grocery list organized by food category
- Error (400): `{ "error": "No meals selected" }`

### Get Dish Ingredients

```
POST /dish-ingredients/
```

**Description:** Get ingredients for a specific dish.

**Request Body:**
```json
{
  "dish_name": "Pasta Carbonara"
}
```

**Response:**
- Success (200): List of ingredients for the dish
- Error (400): `{ "error": "Dish name is required" }`
- Error (404): `{ "error": "Dish not found" }`

### Get Signature Dishes

```
GET /signature-dishes/
```

**Description:** List signature dishes with optional cuisine filter.

**Query Parameters:**
- `cuisine` (optional): Filter by cuisine type (e.g., `?cuisine=Italian`)

**Response:**
- Success (200): List of dishes with details and images

## Error Handling

The API uses standard HTTP status codes:

- `200 OK`: Successful request
- `400 Bad Request`: Invalid request data
- `401 Unauthorized`: Authentication required
- `404 Not Found`: Resource not found
- `405 Method Not Allowed`: Invalid HTTP method
- `500 Internal Server Error`: Server-side error

All error responses follow this format:
```json
{
  "error": "Error message"
}
```

## Rate Limiting

API requests are limited to 100 requests per minute per IP address to prevent abuse.

## CORS Support

The API supports Cross-Origin Resource Sharing (CORS) to allow requests from the frontend application.